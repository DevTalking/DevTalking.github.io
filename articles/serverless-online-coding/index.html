<!doctype html>
<html class="theme-next use-motion ">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-121973094-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-121973094-1');
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-4115205380866695",
          enable_page_level_ads: true
     });
</script>

<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
 <script type="text/x-mathjax-config">
 MathJax.Hub.Config({tex2jax: {inlineMath:[['$','$']]}});
 </script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML' async></script>
<link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">
<style>
    .pace .pace-progress {
        background: #272822; /*进度条颜色*/
        height: 3px;
    }
    .pace .pace-progress-inner {
         box-shadow: 0 0 10px #272822, 0 0 5px #272822; /*阴影颜色*/
    }
    .pace .pace-activity {
        border-top-color: #272822;    /*上边框颜色*/
        border-left-color: #272822;    /*左边框颜色*/
    }
</style>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />








  <link rel="stylesheet" type="text/css" href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5"/>



  
    <link href='//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
  


<link rel="stylesheet" type="text/css" href="/lib/font-awesome/css/font-awesome.min.css?v=4.4.0" />

<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.4.5.2"/>




  <meta name="keywords" content="Serverless," />



  <link rel="alternate" href="/atom.xml" title="程序员说" type="application/atom+xml" />



  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.2" />


<meta name="description" content="说起Serverless这个词，我想大家应该都不陌生，那么Serverless这个词到底是什么意思？Serverless到底能解决什么问题？可能很多朋友还没有深刻的体会和体感。这篇文章我就和大家一起聊聊Serverless。
什么是Serverless我们先将Serverless这个词拆开来看。Server，大家都知道是服务器的意思，说明Serverless解决的问题范围在服务端。Less，大家肯">
<meta property="og:type" content="article">
<meta property="og:title" content="Serverless在编程教育中的实践">
<meta property="og:url" content="http://www.devtalking.com/articles/serverless-online-coding/index.html">
<meta property="og:site_name" content="程序员说">
<meta property="og:description" content="说起Serverless这个词，我想大家应该都不陌生，那么Serverless这个词到底是什么意思？Serverless到底能解决什么问题？可能很多朋友还没有深刻的体会和体感。这篇文章我就和大家一起聊聊Serverless。
什么是Serverless我们先将Serverless这个词拆开来看。Server，大家都知道是服务器的意思，说明Serverless解决的问题范围在服务端。Less，大家肯">
<meta property="og:image" content="https://devtalking.oss-cn-beijing.aliyuncs.com/2020/serverless_online_coding/%E5%9B%BE%E7%89%87%201.png">
<meta property="og:image" content="https://devtalking.oss-cn-beijing.aliyuncs.com/2020/serverless_online_coding/%E5%9B%BE%E7%89%87%202.png">
<meta property="og:image" content="https://devtalking.oss-cn-beijing.aliyuncs.com/2020/serverless_online_coding/%E5%9B%BE%E7%89%87%203.png">
<meta property="og:image" content="https://devtalking.oss-cn-beijing.aliyuncs.com/2020/serverless_online_coding/%E5%9B%BE%E7%89%87%204.png">
<meta property="og:image" content="https://devtalking.oss-cn-beijing.aliyuncs.com/2020/serverless_online_coding/%E5%9B%BE%E7%89%87%205.png">
<meta property="og:image" content="https://devtalking.oss-cn-beijing.aliyuncs.com/2020/serverless_online_coding/%E5%9B%BE%E7%89%87%206.png">
<meta property="og:image" content="https://devtalking.oss-cn-beijing.aliyuncs.com/2020/serverless_online_coding/%E5%9B%BE%E7%89%87%207.png">
<meta property="og:image" content="https://devtalking.oss-cn-beijing.aliyuncs.com/2020/serverless_online_coding/%E5%9B%BE%E7%89%87%208.png">
<meta property="og:image" content="https://devtalking.oss-cn-beijing.aliyuncs.com/2020/serverless_online_coding/%E5%9B%BE%E7%89%87%209.png">
<meta property="og:image" content="https://devtalking.oss-cn-beijing.aliyuncs.com/2020/serverless_online_coding/%E5%9B%BE%E7%89%87%2010.png">
<meta property="og:image" content="https://devtalking.oss-cn-beijing.aliyuncs.com/2020/serverless_online_coding/%E5%9B%BE%E7%89%87%2011.png">
<meta property="og:image" content="https://devtalking.oss-cn-beijing.aliyuncs.com/2020/serverless_online_coding/%E5%9B%BE%E7%89%87%2012.png">
<meta property="og:image" content="https://devtalking.oss-cn-beijing.aliyuncs.com/2020/serverless_online_coding/%E5%9B%BE%E7%89%87%2013.png">
<meta property="og:image" content="https://devtalking.oss-cn-beijing.aliyuncs.com/2020/serverless_online_coding/%E5%9B%BE%E7%89%87%2014.png">
<meta property="og:image" content="https://devtalking.oss-cn-beijing.aliyuncs.com/2020/serverless_online_coding/%E5%9B%BE%E7%89%87%2015.png">
<meta property="og:image" content="https://devtalking.oss-cn-beijing.aliyuncs.com/2020/serverless_online_coding/%E5%9B%BE%E7%89%87%2016.png">
<meta property="og:image" content="https://devtalking.oss-cn-beijing.aliyuncs.com/2020/serverless_online_coding/%E5%9B%BE%E7%89%87%2017.png">
<meta property="og:image" content="https://devtalking.oss-cn-beijing.aliyuncs.com/2020/serverless_online_coding/%E5%9B%BE%E7%89%87%2018.png">
<meta property="og:image" content="https://devtalking.oss-cn-beijing.aliyuncs.com/2020/serverless_online_coding/lagoudemo.gif">
<meta property="og:updated_time" content="2021-02-03T16:01:52.369Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Serverless在编程教育中的实践">
<meta name="twitter:description" content="说起Serverless这个词，我想大家应该都不陌生，那么Serverless这个词到底是什么意思？Serverless到底能解决什么问题？可能很多朋友还没有深刻的体会和体感。这篇文章我就和大家一起聊聊Serverless。
什么是Serverless我们先将Serverless这个词拆开来看。Server，大家都知道是服务器的意思，说明Serverless解决的问题范围在服务端。Less，大家肯">


<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: '',
    sidebar: 'post'
  };
</script>



  <title> Serverless在编程教育中的实践 | 程序员说 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?980738dc41a50d91861a17ad4b768a1f";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



  
<script type="text/javascript">
    //微信二维码点击背景关闭
    $('body').delegate('.-mob-share-weixin-qrcode-bg','click', function(){
         $(".-mob-share-weixin-qrcode-close").trigger("click");
    }); 
</script>


  <div class="container one-column page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">程序员说</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home"></i> <br />
            
            首頁
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th"></i> <br />
            
            分類
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive"></i> <br />
            
            歸檔
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags"></i> <br />
            
            標籤
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content"> 

  <div id="posts" class="posts-expand">
    

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Serverless在编程教育中的实践
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2020-04-20T00:00:00+08:00" content="2020-04-20">
              2020-04-20
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分類於
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/中间件/" itemprop="url" rel="index">
                    <span itemprop="name">中间件</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/articles/serverless-online-coding/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="/articles/serverless-online-coding/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        <span itemprop="articleBody"><script data-ad-client="ca-pub-4115205380866695" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>


<p>说起Serverless这个词，我想大家应该都不陌生，那么Serverless这个词到底是什么意思？Serverless到底能解决什么问题？可能很多朋友还没有深刻的体会和体感。这篇文章我就和大家一起聊聊Serverless。</p>
<h2 id="u4EC0_u4E48_u662FServerless"><a href="#u4EC0_u4E48_u662FServerless" class="headerlink" title="什么是Serverless"></a>什么是Serverless</h2><p>我们先将Serverless这个词拆开来看。Server，大家都知道是服务器的意思，说明Serverless解决的问题范围在服务端。Less，大家肯定也知道它的意思是较少的。那么Serverless连起来，再稍加修饰，那就是较少的关心服务器的意思。</p>
<h3 id="Serverfull_u65F6_u4EE3"><a href="#Serverfull_u65F6_u4EE3" class="headerlink" title="Serverfull时代"></a>Serverfull时代</h3><p>我们都知道，在研发侧都会有研发人员和运维人员两个角色，要开发一个新系统的时候，研发人员根据产品经理的PRD开始写代码开发功能，当功能开发、测试完之后，要发布到服务器。这个时候开始由运维人员规划服务器规格、服务器数量、每个服务部署的节点数量、服务器的扩缩容策略和机制、发布服务过程、服务优雅上下线机制等等。这种模式是研发和运维隔离，服务端运维都由专门的运维人员处理，而且很多时候是靠纯人力处理，也就是Serverfull时代。</p>
<h3 id="DevOps_u65F6_u4EE3"><a href="#DevOps_u65F6_u4EE3" class="headerlink" title="DevOps时代"></a>DevOps时代</h3><p>互联网公司里最辛苦的是谁？我相信大多数都是运维同学。白天做各种网络规划、环境规划、数据库规划等等，晚上熬夜发布新版本，做上线保障，而且很多事情是重复性的工作。然后慢慢就有了赋能研发这样的声音，运维同学帮助研发同学做一套运维控制台，可以让研发同学在运维控制台上自行发布服务、查看日志、查询数据。这样一来，运维同学主要维护这套运维控制台系统，并且不断完善功能，轻松了不少。这就是研发兼运维的DevOps时代。</p>
<h3 id="Serverless_u65F6_u4EE3"><a href="#Serverless_u65F6_u4EE3" class="headerlink" title="Serverless时代"></a>Serverless时代</h3><p>渐渐的，研发同学和运维同学的关注点都在运维控制台了，运维控制台的功能越来越强大，比如根据运维侧的需求增加了自动弹性扩缩、性能监控的功能，根据研发侧的需求增加了自动化发布的流水线功能。因为有了这套系统，代码质量检测、单元测试、打包编译、部署、集成测试、灰度发布、弹性扩缩、性能监控、应用防护这一系列服务端的工作基本上不需要人工参与处理了。这就是NoOps，Serverless时代。</p>
<a id="more"></a>
<h2 id="Serverless_u5728_u7F16_u7A0B_u6559_u80B2_u4E2D_u7684_u5E94_u7528"><a href="#Serverless_u5728_u7F16_u7A0B_u6559_u80B2_u4E2D_u7684_u5E94_u7528" class="headerlink" title="Serverless在编程教育中的应用"></a>Serverless在编程教育中的应用</h2><p>2020年注定是不平凡的一年，疫情期间，多少家企业如割韭菜般倒下，又有多少家企业如雨后春笋般茁壮成长，比如在线教育行业。</p>
<p>没错，在线教育行业是这次疫情的最大受益者，在在线教育在这个行业里，有一个细分市场是在线编程教育，尤其是少儿编程教育和面向非专业人士的编程教育，比如编程猫、斑马AI、小象学院等。这些企业的在线编程系统都有一些共同的特点和诉求：</p>
<ul>
<li>屏幕一侧写代码，执行代码，另一侧显示运行结果。</li>
<li>根据题目编写的代码都是代码块，每道题的代码量不会很大。</li>
<li>运行代码的速度要快。</li>
<li>支持多种编程语言。</li>
<li>能支撑不可预计的流量洪峰冲击。</li>
</ul>
<p>例如小象学院的编程课界面：<br><img src="https://devtalking.oss-cn-beijing.aliyuncs.com/2020/serverless_online_coding/%E5%9B%BE%E7%89%87%201.png" alt=""></p>
<p>结合上述这些特点和诉求，不难看出，构建这样一套在线编程系统的核心在于有一个支持多种编程语言的、健壮高可用的代码运行环境。</p>
<p>那么我们先来看看传统的实现架构：<br><img src="https://devtalking.oss-cn-beijing.aliyuncs.com/2020/serverless_online_coding/%E5%9B%BE%E7%89%87%202.png" alt=""></p>
<p>从High Level的架构来看，前端只需要将代码片段和编程语言的标识传给Server端即可，然后等待响应展示结果。所以整个Server端要负责对不同语言的代码进行分类、预处理然后传给不同编程语言的Runtime。这种架构有以下几个比较核心的问题。</p>
<h3 id="u5DE5_u4F5C_u91CF_u5927_uFF0C_u7075_u6D3B_u6027_u5DEE"><a href="#u5DE5_u4F5C_u91CF_u5927_uFF0C_u7075_u6D3B_u6027_u5DEE" class="headerlink" title="工作量大，灵活性差"></a>工作量大，灵活性差</h3><p>首先是研发和运维工作量的问题，当市场有新的需求，或者洞察到新业务模式时需要增加编程语言，此时研发侧需要增加编程代码分类和预处理的逻辑，另外需要构建对应编程语言的Runtime。在运维侧需要规划支撑新语言的服务器规格以及数量，还有整体的CICD流程等。所以支持新的编程语言这个需求要落地，需要研发、运维花费不少的时间来实现，再加上黑/白盒测试和CICD流程测试的时间，对市场需求的支撑不能快速的响应，灵活性相对较差。</p>
<h3 id="u9AD8_u53EF_u7528_u81EA_u5DF1_u515C_u5E95"><a href="#u9AD8_u53EF_u7528_u81EA_u5DF1_u515C_u5E95" class="headerlink" title="高可用自己兜底"></a>高可用自己兜底</h3><p>其次整个在线编程系统的稳定性是重中之重。所以所有Server端服务的高可用架构都需要自己搭建，用以保证流量高峰场景和稳态场景下的系统稳定。高可用一方面是代码逻辑编写的是否优雅和完善，另一方面是部署服务的集群，无论是ECS集群还是K8s集群，都需要研发和运维同学一起规划，那么对于对编程语言进行分类和预处理的服务来讲，尚能给定一个节点数，但是对于不同语言的Runtime服务来讲，市场需求随时会变，所以不好具体衡量每个服务的节点数。另外很重要的一点是所以服务的扩容，缩容机制都需要运维同学来实时手动操作，即便是通过脚本实现自动化，那么ECS弹起的速度也是远达不到业务预期的。</p>
<h3 id="u6210_u672C_u63A7_u5236_u7C92_u5EA6_u7C97"><a href="#u6210_u672C_u63A7_u5236_u7C92_u5EA6_u7C97" class="headerlink" title="成本控制粒度粗"></a>成本控制粒度粗</h3><p>再次是整个IaaS资源的成本控制，我们都知道这种在线教育是有明显的流量潮汐的，比如上午10点到12点，下午3点到5点，晚上8点到10点这几个时段是流量比较大的时候，其他时间端流量比较小，而且夜晚更是没什么流量。所以在这种情况下，传统的部署架构无法做到IaaS资源和流量的贴合。举个例子，加入为了应对流量高峰时期，需要20台ECS搭建集群来承载流量冲击，此时每台ECS的资源使用率可能在70%以上，利用率较高，但是在流量小的时候和夜晚，每台ECS的资源使用率可能就是百分之十几甚至更低，这就是一种资源浪费。</p>
<h3 id="Serverless_u67B6_u6784"><a href="#Serverless_u67B6_u6784" class="headerlink" title="Serverless架构"></a>Serverless架构</h3><p>那么我们来看看如何使用Serverless架构来实现同样的功能，并且解决上述几个问题。在选择Serverless产品时，在国内自然而然优先想到的就是阿里云的产品。阿里云有两款Serverless架构的产品Serverless 应用引擎和函数计算，这里我们使用函数计算来实现编程教育的场景。</p>
<p>函数计算（Function Compute）是事件驱动的全托管计算服务，简称FC。使用函数计算，我们无需采购与管理服务器等基础设施，只需编写并上传代码。函数计算为您准备好计算资源，弹性地、可靠地运行任务，并提供日志查询、性能监控和报警等功能。</p>
<p>这里不对FC的含义做过多赘述，只举一个例子。FC中有两个概念，一个是服务，一个是函数。一个服务包含多个函数：<br><img src="https://devtalking.oss-cn-beijing.aliyuncs.com/2020/serverless_online_coding/%E5%9B%BE%E7%89%87%203.png" alt=""></p>
<p>这里拿Java微服务架构来对应，可以理解为，FC中的服务是Java中的一个类，FC中的函数是Java类中的一个方法：<br><img src="https://devtalking.oss-cn-beijing.aliyuncs.com/2020/serverless_online_coding/%E5%9B%BE%E7%89%87%204.png" alt=""></p>
<p>但是Java类中的方法固然只能是Java代码，而FC中的函数可以设置不同语言的Runtime来运行不同的编程语言：<br><img src="https://devtalking.oss-cn-beijing.aliyuncs.com/2020/serverless_online_coding/%E5%9B%BE%E7%89%87%205.png" alt=""></p>
<p>这个结构理解清楚之后，我们来看看如何调用FC的函数，这里会引出一个触发器的概念。我们最常使用的HTTP请求协议其实就是一种类型的触发器，在FC里称为HTTP触发器，除了HTTP触发器以外，还提供了OSS（对象存储）触发器、SLS（日志服务）触发器、定时触发器、MNS触发器、CDN触发器等。<br><img src="https://devtalking.oss-cn-beijing.aliyuncs.com/2020/serverless_online_coding/%E5%9B%BE%E7%89%87%206.png" alt=""></p>
<p>从上图可以大概理解，我们可以通过多种途径调用FC中的函数。举例两个场景，比如每当我在指定的OSS Bucket的某个目录下上传一张图片后，就可以触发FC中的函数，函数的逻辑是将刚刚上传的图片下载下来，然后对图片做处理，然后再上传回OSS。再比如向MNS的某个队列发送一条消息，然后触发FC中的函数来处理针对这条消息的逻辑。</p>
<p>最后我们再来看看FC的高可用。每一个函数在运行代码时底层肯定还是IaaS资源，但我们只需要给每个函数设置运行代码时需要的内存数即可，最小128M，最大3G，对使用者而言，不需要考虑多少核数，也不需要知道代码运行在什么样的服务器上，不需要关心启动了多少个函数实例，也不需要关心弹性扩缩的问题等，这些都由FC来处理。<br><img src="https://devtalking.oss-cn-beijing.aliyuncs.com/2020/serverless_online_coding/%E5%9B%BE%E7%89%87%207.png" alt=""></p>
<p>从上图可以看到，高可用有两种策略：</p>
<ul>
<li>给函数设置并发实例数，假如设置为3，那么有三个请求进来时，该函数只启一个实例，但是会启三个线程来运行逻辑。</li>
<li>线程数达到上限后，会再拉起一个函数实例。</li>
</ul>
<p>大家看到这里，可能已经大概对基于FC实现在线编程教育系统的架构有了一个大概的轮廓。</p>
<p><img src="https://devtalking.oss-cn-beijing.aliyuncs.com/2020/serverless_online_coding/%E5%9B%BE%E7%89%87%208.png" alt=""></p>
<p>上图是基于FC实现的在线编程教育系统的架构图，在这个架构下来看看上述那三个核心问题怎么解：</p>
<ul>
<li>工作量和灵活性：我们只需要关注在如何执行代码的业务逻辑上，如果要加新语言，只需要创建一个对应语言Runtime的FC函数即可。</li>
<li>高可用：多线程运行业务逻辑和多实例运行业务逻辑两层高可用保障，并且函数实例的扩缩完全都是FC自动处理，不需要研发和运维同学做任何配置。</li>
<li>成本优化：当没有请求的时候，函数实例是不会被拉起的，此时也不会计费，所以在流量低谷期或者夜间时，整个FC的成本消耗是非常低的。可以做到函数实例个数、计费粒度和流量完美的贴合。</li>
</ul>
<p><img src="https://devtalking.oss-cn-beijing.aliyuncs.com/2020/serverless_online_coding/%E5%9B%BE%E7%89%87%209.png" alt=""></p>
<h2 id="Python_u7F16_u7A0B_u8BED_u8A00_u793A_u4F8B"><a href="#Python_u7F16_u7A0B_u8BED_u8A00_u793A_u4F8B" class="headerlink" title="Python编程语言示例"></a>Python编程语言示例</h2><p>下面以运行Python代码为例来看看如何用FC实现Python在线编程Demo。</p>
<h3 id="u521B_u5EFA_u670D_u52A1_u548C_u51FD_u6570"><a href="#u521B_u5EFA_u670D_u52A1_u548C_u51FD_u6570" class="headerlink" title="创建服务和函数"></a>创建服务和函数</h3><p>打开函数计算（FC）<a href="https://fc.console.aliyun.com/fc/overview/cn-hangzhou" target="_blank" rel="external">控制台</a>，选择对应的Region，选择左侧服务/函数，然后新建服务：<br><img src="https://devtalking.oss-cn-beijing.aliyuncs.com/2020/serverless_online_coding/%E5%9B%BE%E7%89%87%2010.png" alt=""></p>
<p>输出服务名称，创建服务。<br><img src="https://devtalking.oss-cn-beijing.aliyuncs.com/2020/serverless_online_coding/%E5%9B%BE%E7%89%87%2011.png" alt=""></p>
<p>进入新创建的服务，然后创建函数，选择HTTP函数，即可配置HTTP触发器的函数：<br><img src="https://devtalking.oss-cn-beijing.aliyuncs.com/2020/serverless_online_coding/%E5%9B%BE%E7%89%87%2012.png" alt=""></p>
<p>设置函数的各个参数：<br><img src="https://devtalking.oss-cn-beijing.aliyuncs.com/2020/serverless_online_coding/%E5%9B%BE%E7%89%87%2013.png" alt=""></p>
<p>几个需要的注意的参数这里做以说明：</p>
<ul>
<li>运行环境：这个很好理解，这里选择Python3</li>
<li>函数实例类型：这里有弹性实例和性能实例两种，前者最大支持2C3G规格的实例，后者支持更大的规格，最大到8C16G。</li>
<li>函数入口：详细参见<a href="https://help.aliyun.com/document_detail/74756.html?spm=a2c4g.11186623.6.572.195359cdselnzR" target="_blank" rel="external">文档</a></li>
<li>HTTP触发器认证方式：anonymous为不需要鉴权，function是需要鉴权的。</li>
</ul>
<h3 id="u4EE3_u7801_u89E3_u6790"><a href="#u4EE3_u7801_u89E3_u6790" class="headerlink" title="代码解析"></a>代码解析</h3><p>函数创建好，进入函数，可以看到概述、代码执行、触发器、日志查询等页签，我们先看触发器，会看到这个函数自动创建了一个HTTP触发器，有调用该函数对应的HTTP路径：<br><img src="https://devtalking.oss-cn-beijing.aliyuncs.com/2020/serverless_online_coding/%E5%9B%BE%E7%89%87%2014.png" alt=""></p>
<p>然后我们选择代码执行，直接在线写入我们的代码：<br><img src="https://devtalking.oss-cn-beijing.aliyuncs.com/2020/serverless_online_coding/%E5%9B%BE%E7%89%87%2015.png" alt=""></p>
<p>具体代码如下：<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handler</span><span class="params">(environ, start_response)</span>:</span></span><br><span class="line">    context = environ[<span class="string">'fc.context'</span>]</span><br><span class="line">    request_uri = environ[<span class="string">'fc.request_uri'</span>]</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> environ.items():</span><br><span class="line">      <span class="keyword">if</span> k.startswith(<span class="string">'HTTP_'</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">try</span>:        </span><br><span class="line">        request_body_size = int(environ.get(<span class="string">'CONTENT_LENGTH'</span>, <span class="number">0</span>))    </span><br><span class="line">    <span class="keyword">except</span> (ValueError):        </span><br><span class="line">        request_body_size = <span class="number">0</span>   </span><br><span class="line">    <span class="comment"># 获取用户传入的code</span></span><br><span class="line">    request_body = environ[<span class="string">'wsgi.input'</span>].read(request_body_size)  </span><br><span class="line">    codeStr = urllib.parse.unquote(request_body.decode(<span class="string">"GBK"</span>))</span><br><span class="line">    <span class="comment"># 因为body里的对象里有code和input两个属性，这里分别获取用户code和用户输入</span></span><br><span class="line">    codeArr = codeStr.split(<span class="string">'&amp;'</span>)</span><br><span class="line">    code = codeArr[<span class="number">0</span>][<span class="number">5</span>:]</span><br><span class="line">    inputStr = codeArr[<span class="number">1</span>][<span class="number">6</span>:]</span><br><span class="line">    <span class="comment"># 将用户code保存为py文件，放/tmp目录下，以时间戳为文件名</span></span><br><span class="line">    fileName = <span class="string">'/tmp/'</span> + str(int(time.time())) + <span class="string">'.py'</span></span><br><span class="line">    f = open(fileName, <span class="string">"w"</span>)</span><br><span class="line">    <span class="comment"># 这里预置引入了time库</span></span><br><span class="line">    f.write(<span class="string">'import time \r\n'</span>)</span><br><span class="line">    f = open(fileName, <span class="string">"a"</span>)</span><br><span class="line">    f.write(code)</span><br><span class="line">    f.close()</span><br><span class="line">    <span class="comment"># 创建子进程，执行刚才保存的用户code py文件</span></span><br><span class="line">    p = subprocess.Popen(<span class="string">"python "</span> + fileName, stdout=subprocess.PIPE, stdin=subprocess.PIPE, stderr=subprocess.PIPE, shell=<span class="keyword">True</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">    <span class="comment"># 通过标准输入传入用户的input输入</span></span><br><span class="line">    <span class="keyword">if</span> inputStr != <span class="string">''</span> :</span><br><span class="line">        p.stdin.write(inputStr + <span class="string">"\n"</span>)</span><br><span class="line">        p.stdin.flush()</span><br><span class="line">    <span class="comment"># 通过标准输出获取代码执行结果</span></span><br><span class="line">    r = p.stdout.read()</span><br><span class="line">    status = <span class="string">'200 OK'</span></span><br><span class="line">    response_headers = [(<span class="string">'Content-type'</span>, <span class="string">'text/plain'</span>)]</span><br><span class="line">    start_response(status, response_headers)</span><br><span class="line">    <span class="keyword">return</span> [r.encode(<span class="string">'UTF-8'</span>)]</span><br></pre></td></tr></table></figure></p>
<p>整个代码思路如下：</p>
<ul>
<li>从前端传入代码片段，格式是字符串。</li>
<li>在FC函数中获取到传入的代码字符串，截取code内容和input的内容。因为这里简单实现了Python中input交互的能力。</li>
<li>将代码保存为一个Python文件，以时间戳为文件名，保存在FC函数的/tmp目录下。（每个FC函数都有独立的/tmp目录，可以存放临时文件）</li>
<li>然后在文件中追加了引入time库的代码，应对sleep这种交互场景。</li>
<li>通过subprocess创建子进程，以Shell的方式通过Python命令执行保存在/tmp目录下的Python文件。如果有用户输入的信息，则通过标准输入输出写入子进程。</li>
<li>最后读取执行结果返回给前端。</li>
</ul>
<h3 id="u524D_u7AEF_u4EE3_u7801"><a href="#u524D_u7AEF_u4EE3_u7801" class="headerlink" title="前端代码"></a>前端代码</h3><p>前端我使用VUE写了简单的页面，这里解析两个简单的方法：<br><img src="https://devtalking.oss-cn-beijing.aliyuncs.com/2020/serverless_online_coding/%E5%9B%BE%E7%89%87%2016.png" alt=""></p>
<p>页面加载时初始化HTTP请求对象，调用的HTTP路径就是方才函数的HTTP触发器的路径。</p>
<p><img src="https://devtalking.oss-cn-beijing.aliyuncs.com/2020/serverless_online_coding/%E5%9B%BE%E7%89%87%2017.png" alt=""></p>
<p>这个方法就是调用FC中的PythonRuntime函数，将前端页面的代码片段传给该函数。这里处理input交互的思路是，扫描整个代码片段，以包含input代码为标识将整个代码段分成多段。没有包含input代码的直接送给FC函数执行，包含input代码的，请求用户的输入，然后代码片段带着用户输入的信息一起送给FC函数执行。<br><img src="https://devtalking.oss-cn-beijing.aliyuncs.com/2020/serverless_online_coding/%E5%9B%BE%E7%89%87%2018.png" alt=""></p>
<p>演示如下：<br><img src="https://devtalking.oss-cn-beijing.aliyuncs.com/2020/serverless_online_coding/lagoudemo.gif" alt=""></p>
<h2 id="u7ED3_u675F_u8BED"><a href="#u7ED3_u675F_u8BED" class="headerlink" title="结束语"></a>结束语</h2><p>这篇文章洋洋洒洒给大家介绍了Serverless，阿里云的Serverless产品函数计算（FC）以及基于函数计算（FC）实现的在线编程系统的Demo。大家应该有所体感，基于函数计算（FC）实现在线编程系统时，研发同学只需要专注在如何执行由前端传入的代码即可，整个Server端的各个环节都不需要研发同学和运维同学去关心，基本体现了Serverless的精髓。</p>
</span>
      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Serverless/" rel="tag">#Serverless</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/articles/kafka-practice-19/" rel="next" title="Kafka从上手到实践-Kafka集群：重要配置和性能探讨">
                <i class="fa fa-chevron-left"></i> Kafka从上手到实践-Kafka集群：重要配置和性能探讨
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/articles/serverless-saas/" rel="prev" title="Serverless在SaaS领域中的实践">
                Serverless在SaaS领域中的实践 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        <!--MOB SHARE BEGIN-->
<div class="-hoofoo-share-title">分享到：</div>
<div class="-hoofoo-share-buttons">
    <div class="-mob-share-weibo -hoofoo-share-weibo -hoofoo-share-ui-button"><i class="fa fa-weibo" aria-hidden="true"></i></div>
    <div class="-mob-share-weixin -hoofoo-share-weixin -hoofoo-share-ui-button"><i class="fa fa-weixin" aria-hidden="true"></i></div>
    <div class="-mob-share-twitter -hoofoo-share-twitter -hoofoo-share-ui-button"><i class="fa fa-twitter" aria-hidden="true"></i></div>
    <div class="-hoofoo-share-more -hoofoo-share-ui-button -mob-share-open"><i class="fa fa-ellipsis-h" aria-hidden="true"></i></div>
</div><div class="-mob-share-ui -mob-share-ui-theme -mob-share-ui-theme-slide-left" style="display: none">
    <ul class="-mob-share-list">
        <li class="-mob-share-weixin"><p>微信</p></li>
        <li class="-mob-share-pocket"><p>Pocket</p></li>
        <li class="-mob-share-instapaper"><p>Instapaper</p></li>
        <li class="-mob-share-linkedin"><p>Linkedin</p></li>
        <li class="-mob-share-twitter"><p>Twitter</p></li>
        <li class="-mob-share-weibo"><p>新浪微博</p></li>
        <li class="-mob-share-douban"><p>豆瓣</p></li>
        <li class="-mob-share-facebook"><p>Facebook</p></li>
        <li class="-mob-share-google"><p>Google+</p></li>
    </ul>
    <div class="-mob-share-close">取消</div>
</div>
<div class="-mob-share-ui-bg"></div>
<script id="-mob-share" src="http://f1.webshare.mob.com/code/mob-share.js?appkey=26252752de4d6"></script>
<!--MOB SHARE END--> 
      
    </div>
  </div>

 </div>

        

        
          <div class="comments" id="comments">
            
              <div id="disqus_thread">
                <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
              </div>
            
          </div>
        
      </div>

      
        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目錄
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            本站概覽
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="http://www.devtalking.com/devtalking.png" alt="DevTalking" itemprop="image"/>
          <p class="site-author-name" itemprop="name">DevTalking</p>
        </div>
        <p class="site-description motion-element" itemprop="description"></p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">117</span>
              <span class="site-state-item-name">文章</span>
            </a>
          </div>

         <!-- <div class="site-state-item site-state-categories">
            <a href="/categories">
              <span class="site-state-item-count">10</span>
              <span class="site-state-item-name">分類</span>
              </a>
          </div> -->

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">93</span>
              <span class="site-state-item-name">標籤</span>
              </a>
          </div>

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="menu-item-icon icon-next-feed"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://www.linkedin.com/in/宇轩-付-5aa406a6" target="_blank">
                  
                    <i class="fa fa-linkedin"></i> linkedin
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="mailto:jace.fu@icloud.com" target="_blank">
                  
                    <i class="fa fa-envelope"></i> Email
                  
                </a>
              </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator"></div>
          <div class="post-toc">
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#u4EC0_u4E48_u662FServerless"><span class="nav-number">1.</span> <span class="nav-text">什么是Serverless</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Serverfull_u65F6_u4EE3"><span class="nav-number">1.1.</span> <span class="nav-text">Serverfull时代</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DevOps_u65F6_u4EE3"><span class="nav-number">1.2.</span> <span class="nav-text">DevOps时代</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Serverless_u65F6_u4EE3"><span class="nav-number">1.3.</span> <span class="nav-text">Serverless时代</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Serverless_u5728_u7F16_u7A0B_u6559_u80B2_u4E2D_u7684_u5E94_u7528"><span class="nav-number">2.</span> <span class="nav-text">Serverless在编程教育中的应用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#u5DE5_u4F5C_u91CF_u5927_uFF0C_u7075_u6D3B_u6027_u5DEE"><span class="nav-number">2.1.</span> <span class="nav-text">工作量大，灵活性差</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#u9AD8_u53EF_u7528_u81EA_u5DF1_u515C_u5E95"><span class="nav-number">2.2.</span> <span class="nav-text">高可用自己兜底</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#u6210_u672C_u63A7_u5236_u7C92_u5EA6_u7C97"><span class="nav-number">2.3.</span> <span class="nav-text">成本控制粒度粗</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Serverless_u67B6_u6784"><span class="nav-number">2.4.</span> <span class="nav-text">Serverless架构</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Python_u7F16_u7A0B_u8BED_u8A00_u793A_u4F8B"><span class="nav-number">3.</span> <span class="nav-text">Python编程语言示例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#u521B_u5EFA_u670D_u52A1_u548C_u51FD_u6570"><span class="nav-number">3.1.</span> <span class="nav-text">创建服务和函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#u4EE3_u7801_u89E3_u6790"><span class="nav-number">3.2.</span> <span class="nav-text">代码解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#u524D_u7AEF_u4EE3_u7801"><span class="nav-number">3.3.</span> <span class="nav-text">前端代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#u7ED3_u675F_u8BED"><span class="nav-number">4.</span> <span class="nav-text">结束语</span></a></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator"></div>
        </section>
      

    </div>
  </aside>


      
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner"> <div class="copyright" >
  
  &copy;  2014 - 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">DevTalking</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 強力驅動
</div>

<div class="theme-info">
  主題 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>
</div>


 </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  
  
    
    

  

    <script type="text/javascript">
      var disqus_shortname = 'jacefu';
      var disqus_identifier = '/articles/serverless-online-coding/';
      var disqus_title = 'Serverless在编程教育中的实践';
      var disqus_url = 'http://www.devtalking.com//articles/serverless-online-coding/';

      function run_disqus_script(disqus_script){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');
      
        run_disqus_script('embed.js');
      
    </script>
  


  
  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script>
  

  <script type="text/javascript" src="/lib/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/js/motion_global.js?v=0.4.5.2" id="motion.global"></script>




  <script type="text/javascript" src="/js/nav-toggle.js?v=0.4.5.2"></script>
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  
<script type="text/javascript" src="/js/bootstrap.scrollspy.js?v=0.4.5.2" id="bootstrap.scrollspy.custom"></script>


<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.motion.complete', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      var $indicator = $(indicator);
      var opacity = action === 'show' ? 0.4 : 0;
      $indicator.velocity ?
        $indicator.velocity('stop').velocity({
          opacity: opacity
        }, { duration: 100 }) :
        $indicator.stop().animate({
          opacity: opacity
        }, 100);
    }

  });
</script>

<script type="text/javascript" id="sidebar.nav">
  $(document).ready(function () {
    var html = $('html');
    var TAB_ANIMATE_DURATION = 200;
    var hasVelocity = $.isFunction(html.velocity);

    $('.sidebar-nav li').on('click', function () {
      var item = $(this);
      var activeTabClassName = 'sidebar-nav-active';
      var activePanelClassName = 'sidebar-panel-active';
      if (item.hasClass(activeTabClassName)) {
        return;
      }

      var currentTarget = $('.' + activePanelClassName);
      var target = $('.' + item.data('target'));

      hasVelocity ?
        currentTarget.velocity('transition.slideUpOut', TAB_ANIMATE_DURATION, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', TAB_ANIMATE_DURATION)
            .addClass(activePanelClassName);
        }) :
        currentTarget.animate({ opacity: 0 }, TAB_ANIMATE_DURATION, function () {
          currentTarget.hide();
          target
            .stop()
            .css({'opacity': 0, 'display': 'block'})
            .animate({ opacity: 1 }, TAB_ANIMATE_DURATION, function () {
              currentTarget.removeClass(activePanelClassName);
              target.addClass(activePanelClassName);
            });
        });

      item.siblings().removeClass(activeTabClassName);
      item.addClass(activeTabClassName);
    });

    $('.post-toc a').on('click', function (e) {
      e.preventDefault();
      var targetSelector = escapeSelector(this.getAttribute('href'));
      var offset = $(targetSelector).offset().top;
      hasVelocity ?
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        }) :
        $('html, body').stop().animate({
          scrollTop: offset
        }, 500);
    });

    // Expand sidebar on post detail page by default, when post has a toc.
    var $tocContent = $('.post-toc-content');
    if (isDesktop() && CONFIG.sidebar === 'post') {
      if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
        displaySidebar();
      }
    }
  });
</script>



  <script type="text/javascript">
    $(document).ready(function () {
      if (CONFIG.sidebar === 'always') {
        displaySidebar();
      }
      if (isMobile()) {
        FastClick.attach(document.body);
      }

      motionIntegrator.bootstrap();
    });
  </script>

  
  

  
  

  
  <script type="text/javascript" src="/js/lazyload.js"></script>
  <script type="text/javascript">
    $(function () {
      $("#posts").find('img').lazyload({
        placeholder: "/images/loading.gif",
        effect: "fadeIn"
      });
    });
  </script>
</body>
</html>
